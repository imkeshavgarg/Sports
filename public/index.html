<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signup Page</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>

  <style>
    .box {
      display: none;
      max-width: 500px;
      margin: 30px auto;
      background-color: #f8f9fa;
      padding: 25px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5rem;
      cursor: pointer;
      color: #888;
    }

    .close-btn:hover {
      color: #000;
    }
  </style>

  <script>
    $(document).ready(function () {
      $("#btnSignup").click(function () {
        $(".box").slideUp();
        $("#signupBox").slideToggle();
      });

      $("#btnLogin").click(function () {
        $(".box").slideUp();
        $("#loginBox").slideToggle();
      });

      $(".close-btn").click(function () {
        $(this).closest(".box").slideUp();
      });

      $("#signupBtn").click(function () {
        let email = $("#txtEmail").val();
        let pwd = $("#txtPwd").val();
        let userType = $("#comboUser").val();

        if (email === "" || pwd === "" || userType === "") {
          alert("Please fill all fields.");
          return;
        }

        $.ajax({
          type: "POST",
          url: "/server-signup",
          data: {
            txtEmail: email,
            txtPwd: pwd,
            comboUser: userType
          }
        })
          .done(function (response) {
            alert(response);
            $("#signupForm")[0].reset();
          })
          .fail(function (err) {
            alert("Error: " + err.responseText);
          });
      });

      // Login AJAX
      /* $("#loginBtn").click(function () {
        let email = $("#loginEmail").val();
        let pwd = $("#loginPwd").val();

        if (email === "" || pwd === "") {
          alert("Please enter both email and password.");
          return;
        }

        $.ajax({
          type: "GET",
          url: "/do-login",
          data: {
            txtEmail: email,
            txtPwd: pwd
          }
        })
          .done(function (response) {
            alert(response);
            $("#loginForm")[0].reset();
          })
          .fail(function (err) {
            alert("Error: " + err.responseText);
          });
      }); */
      $("#loginBtn").click(function () {
        let email = $("#loginEmail").val();
        let pwd = $("#loginPwd").val();

        if (email === "" || pwd === "") {
          alert("Please enter both email and password.");
          return;
        }

        $.ajax({
          type: "GET",
          url: "/do-login",
          data: {
            txtEmail: email,
            txtPwd: pwd
          }
        })
          .then(function (response) {
  console.log("Login response:", response); // Add this to debug

  if (response === "Blocked") {
    alert("Sorry!! Your ID is Blocked");
  } else if (response === "Invalid") {
    alert("Invalid email ID or password");
  } else {
    const role = response.trim().toLowerCase();

    if (role === "player") {
      localStorage.setItem("activeUser",email);
      location.href = "player-dash.html";
    } else if (role === "organizer") {
            localStorage.setItem("activeUser",email);
      location.href = "org-dash.html";
    } else if (role === "admin") {
            localStorage.setItem("activeUser",email);
      location.href = "dashAdmin.html";
    } else {
      alert("Unexpected role: " + response); // ‚Üê If you still get this, check console
    }
  }
})


      });

    });
  </script>
</head>

<body class="bg-light">

  <div class="container text-center mt-4">
    <button id="btnLogin" class="btn btn-outline-primary me-2">Login</button>
    <button id="btnSignup" class="btn btn-primary">Signup</button>
    <a href="./org-dash.html" class="btn btn-primary">org-dash</a>
    <a href="./player-dash.html" class="btn btn-primary">Player-dash</a>
    <a href="./dashAdmin.html" class="btn btn-primary">Admin-dash</a>

  </div>

  <!-- Signup Box -->
  <div id="signupBox" class="box">
    <span class="close-btn">&times;</span>
    <h3 class="text-center mb-4">Signup</h3>
    <form id="signupForm">
      <div class="mb-3">
        <label>Email ID</label>
        <input type="email" class="form-control" name="txtEmail" id="txtEmail" required />
      </div>
      <div class="mb-3">
        <label>Password</label>
        <input type="password" class="form-control" name="txtPwd" id="txtPwd" required />
      </div>
      <div class="mb-3">
        <label>User Type</label>
        <select class="form-select" name="comboUser" id="comboUser" required>
          <option value="player">Player</option>
          <option value="organizer">Organizer</option>
        </select>
      </div>
      <button type="button" class="btn btn-primary" id="signupBtn">Signup</button>
    </form>
  </div>

  <!-- Login Box -->
  <div id="loginBox" class="box">
    <span class="close-btn">&times;</span>
    <h3 class="text-center mb-4">Login</h3>
    <form id="loginForm">
      <div class="mb-3">
        <label>Email ID</label>
        <input type="email" class="form-control" id="loginEmail" required />
      </div>
      <div class="mb-3">
        <label>Password</label>
        <input type="password" class="form-control" id="loginPwd" required />
      </div>
      <button type="button" class="btn btn-primary" id="loginBtn">Login</button>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>